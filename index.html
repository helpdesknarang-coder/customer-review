<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logo Rating Page</title>
<style>
  body { margin: 0; height: 100vh; display: flex; justify-content: flex-start; align-items: center; flex-direction: column; background: linear-gradient(135deg, #F7F4F1, #F7F4F1); font-family: Arial, sans-serif; padding-top: 70px; }
  .logo { width: 150px; height: 150px; object-fit: contain; margin-bottom: 20px; }
  .stars { display: flex; gap: 10px; margin-bottom: 20px; }
  .star { font-size: 40px; cursor: pointer; color: #ccc; transition: color 0.3s; }
  .star.selected { color: gold; }
  textarea { width: 300px; height: 100px; padding: 10px; border-radius: 8px; border: 1px solid #ccc; resize: none; font-size: 16px; margin-bottom: 20px; }
  button { padding: 10px 25px; font-size: 16px; border: none; border-radius: 8px; background-color: #ffb6c1; cursor: pointer; transition: background 0.3s; }
  button:hover { background-color: #ff99aa; }
</style>
</head>
<body>
<img src="logo.png" alt="Logo" class="logo">

<div class="stars" id="stars">
  <span class="star" data-value="1">&#9733;</span>
  <span class="star" data-value="2">&#9733;</span>
  <span class="star" data-value="3">&#9733;</span>
  <span class="star" data-value="4">&#9733;</span>
  <span class="star" data-value="5">&#9733;</span>
</div>


<input id="customerNameInput" type="text" placeholder="Enter your Name" style="width: 300px; height: 20px; padding: 10px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 3px;">
<input id="customerMobileInput" type="text" placeholder="Enter your Number" style="width: 300px; height: 20px; padding: 10px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 2px;">


<textarea placeholder="Your feedback" id="remark"></textarea>
<button id="submitBtn">Submit</button>

<script type="module">


async function getUserIP() {
  try {
    const response = await fetch("https://api64.ipify.org?format=json");
    const data = await response.json();
    return data.ip;
  } catch (error) {
    console.error("Error fetching IP:", error);
    return null;
  }
}

















  // ‚≠ê Firebase SDK imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
 /* import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";*/
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // üîπ Apna Firebase Config Yahan Paste Karo
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCCs4q6ZWCZxn1ipUO0PD2tgjJYlZgID3Y",
  authDomain: "review-549eb.firebaseapp.com",
  projectId: "review-549eb",
  storageBucket: "review-549eb.firebasestorage.app",
  messagingSenderId: "496902878339",
  appId: "1:496902878339:web:0b6f6d69195e0b1ee657b6",
  measurementId: "G-HKEV1NXBC5"
};


  // üîπ Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Salesman info from QR or fallback
  const urlParams = new URLSearchParams(window.location.search);
  const salesmanId = urlParams.get("sid") || "TEST001";
  const salesmanName = urlParams.get("name") || "Test Name";
  const salesmanMobile = urlParams.get("mobile") || "0000000000";
  

  const stars = document.querySelectorAll('.star');
  let selectedRating = 0;

  stars.forEach(star => {
    star.addEventListener('click', () => {
      selectedRating = parseInt(star.dataset.value);
      stars.forEach(s => {
        s.classList.toggle('selected', parseInt(s.dataset.value) <= selectedRating);
      });
    });
  });

  document.getElementById('submitBtn').addEventListener('click', async () => {
    const remark = document.getElementById('remark').value;
const customerName = document.getElementById('customerNameInput').value.trim();
  const customerMobile = document.getElementById('customerMobileInput').value.trim();
    if(selectedRating === 0){
      alert("Please select a rating!");
      return;
    }




 const ip = await getUserIP();
  if (!ip) {
    alert("Unable to capture IP address. Please check your internet connection.");
    return;
  }

  // Check if this IP already submitted review for this salesman today
  const reviewsRef = collection(db, "reviews");
  const today = new Date();
  today.setHours(0, 0, 0, 0);  // start of today

  // Firestore query to find existing reviews for this salesman + IP where createdAt is today
  const q = query(
    reviewsRef,
    where("salesmanId", "==", salesmanId),
    where("ip", "==", ip),
    where("createdAt", ">=", today)
  );

  const querySnapshot = await getDocs(q);
  if (!querySnapshot.empty) {
    alert("You have already submitted a review today for this salesman.");
    return;
  }
























    try {
      // üîπ Save to Firestore (auto-generated Document ID)
      await addDoc(collection(db, "reviews"), {
        salesmanId: String(salesmanId),
        salesmanName: String(salesmanName),
        salesmanMobile: String(salesmanMobile),
        customerName: String(customerName),
        customerMobile:String(customerMobile),
        rating: Number(selectedRating),
        remark: String(remark),
        ip: ip,
        createdAt: new Date()  // timestamp
      });
      alert("‚úÖ Thank you for your feedback!");
      document.getElementById('remark').value = "";
      stars.forEach(s => s.classList.remove('selected'));
      selectedRating = 0;
    } catch (error) {
      console.error("Error submitting review: ", error);
      alert("‚ùå Error submitting review. Please try again.");
    }
  });

 


 

</script>

</body>
</html>
